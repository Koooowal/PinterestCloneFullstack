import{j as n,I as k,c as J,R as x,r as u,u as Q,a as U,b as q}from"./index-BVxYbke-.js";import{u as V,a as W}from"./useMutation-sTCjTjo-.js";import"./useBaseQuery-911XUJo2.js";const Z=({setIsNewBoardOpen:e,setNewBoard:t})=>{const a=r=>{r.preventDefault();const o=r.target[0].value;t(o),e(!1)};return n.jsx("div",{className:"boardForm",children:n.jsxs("div",{className:"boardFormContainer",children:[n.jsx("div",{className:"boardFormClose",onClick:()=>e(!1),children:n.jsx(k,{path:"/general/delete.svg",alt:"",w:20,h:20})}),n.jsxs("form",{onSubmit:a,children:[n.jsx("h1",{children:"Create a new board"}),n.jsx("input",{type:"text",placeholder:"Board Title"}),n.jsx("button",{children:"Create"})]})]})})},E=J(e=>({selectedLayer:"canvas",textOptions:{text:"",fontSize:48,color:"#000000",top:48,left:0},canvasOptions:{orientation:"",size:"original",height:0,backgroundColor:"teal"},setSelectedLayer:t=>e({selectedLayer:t}),setTextOptions:t=>e({textOptions:t}),addText:()=>e({textOptions:{text:"Add text",fontSize:48,color:"#000000",top:48,left:0}}),setCanvasOptions:t=>e({canvasOptions:t}),resetStore:()=>e({selectedLayer:"canvas",textOptions:{text:"",fontSize:48,color:"#000000",top:48,left:0},canvasOptions:{height:0,orientation:"",size:"original",backgroundColor:"#008080"}})}));function G(){const{selectedLayer:e,setSelectedLayer:t,addText:a,canvasOptions:r}=E(),o=s=>{t(s),s==="text"&&a()};return n.jsxs("div",{className:"layers",children:[n.jsxs("div",{className:"layersTitle",children:[n.jsx("h3",{children:"Layers"}),n.jsx("p",{children:"Select a layer to edit"})]}),n.jsxs("div",{onClick:()=>o("text"),className:`layer ${e==="text"?"selected":""}`,children:[n.jsx("div",{className:"layerImage",children:n.jsx(k,{path:"/general/text.png",alt:"",w:48,h:48})}),n.jsx("span",{children:"Add Text"})]}),n.jsxs("div",{onClick:()=>o("canvas"),className:`layer ${e==="canvas"?"selected":""}`,children:[n.jsx("div",{className:"layerImage",style:{backgroundColor:r.backgroundColor}}),n.jsx("span",{children:"Canvas"})]})]})}function M(){return(M=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function A(e,t){if(e==null)return{};var a,r,o={},s=Object.keys(e);for(r=0;r<s.length;r++)t.indexOf(a=s[r])>=0||(o[a]=e[a]);return o}function R(e){var t=u.useRef(e),a=u.useRef(function(r){t.current&&t.current(r)});return t.current=e,a.current}var O=function(e,t,a){return t===void 0&&(t=0),a===void 0&&(a=1),e>a?a:e<t?t:e},_=function(e){return"touches"in e},B=function(e){return e&&e.ownerDocument.defaultView||self},D=function(e,t,a){var r=e.getBoundingClientRect(),o=_(t)?function(s,c){for(var l=0;l<s.length;l++)if(s[l].identifier===c)return s[l];return s[0]}(t.touches,a):t;return{left:O((o.pageX-(r.left+B(e).pageXOffset))/r.width),top:O((o.pageY-(r.top+B(e).pageYOffset))/r.height)}},I=function(e){!_(e)&&e.preventDefault()},K=x.memo(function(e){var t=e.onMove,a=e.onKey,r=A(e,["onMove","onKey"]),o=u.useRef(null),s=R(t),c=R(a),l=u.useRef(null),f=u.useRef(!1),d=u.useMemo(function(){var y=function(b){I(b),(_(b)?b.touches.length>0:b.buttons>0)&&o.current?s(D(o.current,b,l.current)):C(!1)},h=function(){return C(!1)};function C(b){var m=f.current,N=B(o.current),w=b?N.addEventListener:N.removeEventListener;w(m?"touchmove":"mousemove",y),w(m?"touchend":"mouseup",h)}return[function(b){var m=b.nativeEvent,N=o.current;if(N&&(I(m),!function(F,L){return L&&!_(F)}(m,f.current)&&N)){if(_(m)){f.current=!0;var w=m.changedTouches||[];w.length&&(l.current=w[0].identifier)}N.focus(),s(D(N,m,l.current)),C(!0)}},function(b){var m=b.which||b.keyCode;m<37||m>40||(b.preventDefault(),c({left:m===39?.05:m===37?-.05:0,top:m===40?.05:m===38?-.05:0}))},C]},[c,s]),g=d[0],i=d[1],j=d[2];return u.useEffect(function(){return j},[j]),x.createElement("div",M({},r,{onTouchStart:g,onMouseDown:g,className:"react-colorful__interactive",ref:o,onKeyDown:i,tabIndex:0,role:"slider"}))}),T=function(e){return e.filter(Boolean).join(" ")},X=function(e){var t=e.color,a=e.left,r=e.top,o=r===void 0?.5:r,s=T(["react-colorful__pointer",e.className]);return x.createElement("div",{className:s,style:{top:100*o+"%",left:100*a+"%"}},x.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:t}}))},v=function(e,t,a){return t===void 0&&(t=0),a===void 0&&(a=Math.pow(10,t)),Math.round(a*e)/a},ee=function(e){return oe(z(e))},z=function(e){return e[0]==="#"&&(e=e.substring(1)),e.length<6?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:e.length===4?v(parseInt(e[3]+e[3],16)/255,2):1}:{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16),a:e.length===8?v(parseInt(e.substring(6,8),16)/255,2):1}},te=function(e){return re(ae(e))},ne=function(e){var t=e.s,a=e.v,r=e.a,o=(200-t)*a/100;return{h:v(e.h),s:v(o>0&&o<200?t*a/100/(o<=100?o:200-o)*100:0),l:v(o/2),a:v(r,2)}},P=function(e){var t=ne(e);return"hsl("+t.h+", "+t.s+"%, "+t.l+"%)"},ae=function(e){var t=e.h,a=e.s,r=e.v,o=e.a;t=t/360*6,a/=100,r/=100;var s=Math.floor(t),c=r*(1-a),l=r*(1-(t-s)*a),f=r*(1-(1-t+s)*a),d=s%6;return{r:v(255*[r,l,c,c,f,r][d]),g:v(255*[f,r,r,l,c,c][d]),b:v(255*[c,c,f,r,r,l][d]),a:v(o,2)}},S=function(e){var t=e.toString(16);return t.length<2?"0"+t:t},re=function(e){var t=e.r,a=e.g,r=e.b,o=e.a,s=o<1?S(v(255*o)):"";return"#"+S(t)+S(a)+S(r)+s},oe=function(e){var t=e.r,a=e.g,r=e.b,o=e.a,s=Math.max(t,a,r),c=s-Math.min(t,a,r),l=c?s===t?(a-r)/c:s===a?2+(r-t)/c:4+(t-a)/c:0;return{h:v(60*(l<0?l+6:l)),s:v(s?c/s*100:0),v:v(s/255*100),a:o}},se=x.memo(function(e){var t=e.hue,a=e.onChange,r=T(["react-colorful__hue",e.className]);return x.createElement("div",{className:r},x.createElement(K,{onMove:function(o){a({h:360*o.left})},onKey:function(o){a({h:O(t+360*o.left,0,360)})},"aria-label":"Hue","aria-valuenow":v(t),"aria-valuemax":"360","aria-valuemin":"0"},x.createElement(X,{className:"react-colorful__hue-pointer",left:t/360,color:P({h:t,s:100,v:100,a:1})})))}),ie=x.memo(function(e){var t=e.hsva,a=e.onChange,r={backgroundColor:P({h:t.h,s:100,v:100,a:1})};return x.createElement("div",{className:"react-colorful__saturation",style:r},x.createElement(K,{onMove:function(o){a({s:100*o.left,v:100-100*o.top})},onKey:function(o){a({s:O(t.s+100*o.left,0,100),v:O(t.v-100*o.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+v(t.s)+"%, Brightness "+v(t.v)+"%"},x.createElement(X,{className:"react-colorful__saturation-pointer",top:1-t.v/100,left:t.s/100,color:P(t)})))}),Y=function(e,t){if(e===t)return!0;for(var a in e)if(e[a]!==t[a])return!1;return!0},le=function(e,t){return e.toLowerCase()===t.toLowerCase()||Y(z(e),z(t))};function ce(e,t,a){var r=R(a),o=u.useState(function(){return e.toHsva(t)}),s=o[0],c=o[1],l=u.useRef({color:t,hsva:s});u.useEffect(function(){if(!e.equal(t,l.current.color)){var d=e.toHsva(t);l.current={hsva:d,color:t},c(d)}},[t,e]),u.useEffect(function(){var d;Y(s,l.current.hsva)||e.equal(d=e.fromHsva(s),l.current.color)||(l.current={hsva:s,color:d},r(d))},[s,e,r]);var f=u.useCallback(function(d){c(function(g){return Object.assign({},g,d)})},[]);return[s,f]}var de=typeof window<"u"?u.useLayoutEffect:u.useEffect,ue=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},H=new Map,he=function(e){de(function(){var t=e.current?e.current.ownerDocument:document;if(t!==void 0&&!H.has(t)){var a=t.createElement("style");a.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,H.set(t,a);var r=ue();r&&a.setAttribute("nonce",r),t.head.appendChild(a)}},[])},fe=function(e){var t=e.className,a=e.colorModel,r=e.color,o=r===void 0?a.defaultColor:r,s=e.onChange,c=A(e,["className","colorModel","color","onChange"]),l=u.useRef(null);he(l);var f=ce(a,o,s),d=f[0],g=f[1],i=T(["react-colorful",t]);return x.createElement("div",M({},c,{ref:l,className:i}),x.createElement(ie,{hsva:d,onChange:g}),x.createElement(se,{hue:d.h,onChange:g,className:"react-colorful__last-control"}))},pe={defaultColor:"000",toHsva:ee,fromHsva:function(e){return te({h:e.h,s:e.s,v:e.v,a:1})},equal:le},$=function(e){return x.createElement(fe,M({},e,{colorModel:pe}))};const me=[{name:"1:2",width:1,height:2},{name:"9:16",width:9,height:16},{name:"2:3",width:2,height:3},{name:"3:4",width:3,height:4},{name:"4:5",width:4,height:5},{name:"1:1",width:1,height:1}],ve=[{name:"2:1",width:2,height:1},{name:"16:9",width:16,height:9},{name:"3:2",width:3,height:2},{name:"4:3",width:4,height:3},{name:"5:4",width:5,height:4},{name:"1:1",width:1,height:1}];function xe({previewImg:e}){const{selectedLayer:t,textOptions:a,setTextOptions:r,canvasOptions:o,setCanvasOptions:s}=E(),[c,l]=u.useState(!1),f=e.width<e.height?"portrait":"landscape",d=i=>{let j;f===i?j=375*e.height/e.width:j=375*e.width/e.height,s({...o,orientation:i,size:"original",height:j})},g=i=>{let j;i==="original"?f===o.orientation?j=375*e.height/e.width:j=375*e.width/e.height:j=375*i.height/i.width,s({...o,size:i==="original"?"original":i.name,height:j})};return n.jsx("div",{className:"options",children:t==="text"?n.jsxs("div",{className:"",children:[n.jsxs("div",{className:"editingOption",children:[n.jsx("span",{children:"Font Size"}),n.jsx("input",{type:"number",value:a.fontSize,onChange:i=>r({...a,fontSize:i.target.value})})]}),n.jsxs("div",{className:"editingOption",children:[n.jsx("span",{children:"Color"}),n.jsxs("div",{className:"textColor",children:[n.jsx("div",{className:"colorPreview",style:{backgroundColor:a.color},onClick:()=>setIsColorPickerOpen(i=>!i)}),c&&n.jsx("div",{className:"colorPicker",children:n.jsx($,{color:a.color,onChange:i=>r({...a,color:i})})})]})]})]}):n.jsxs("div",{className:"",children:[n.jsxs("div",{className:"editingOption",children:[n.jsx("span",{children:"Orientation"}),n.jsxs("div",{className:"orientations",children:[n.jsx("div",{className:`orientation ${o.orientation==="portrait"?"selected":""}`,onClick:()=>d("portrait"),children:"P"}),n.jsx("div",{className:`orientation ${o.orientation==="landscape"?"selected":""}`,onClick:()=>d("landscape"),children:"L"})]})]}),n.jsxs("div",{className:"editingOption",children:[n.jsx("span",{children:"Size"}),n.jsxs("div",{className:"sizes",children:[n.jsx("div",{className:`size ${o.size==="original"?"selected":""}`,onClick:()=>g("original"),children:"Original"}),o.orientation==="portrait"?n.jsx(n.Fragment,{children:me.map(i=>n.jsx("div",{className:`size ${o.size===i.name?"selected":""}`,onClick:()=>g(i),children:i.name},i.name))}):n.jsx(n.Fragment,{children:ve.map(i=>n.jsx("div",{className:`size ${o.size===i.name?"selected":""}`,onClick:()=>g(i),children:i.name},i.name))})]})]}),n.jsxs("div",{className:"editingOption",children:[n.jsx("span",{children:"Background Color"}),n.jsx("div",{className:"bgColor",children:n.jsxs("div",{className:"textColor",children:[n.jsx("div",{className:"colorPreview",style:{backgroundColor:o.backgroundColor},onClick:()=>l(i=>!i)}),c&&n.jsx("div",{className:"colorPicker",children:n.jsx($,{color:o.backgroundColor,onChange:i=>s({...o,backgroundColor:i})})})]})})]})]})})}function ge({previewImg:e}){const{textOptions:t,setTextOptions:a,canvasOptions:r,setCanvasOptions:o,setSelectedLayer:s}=E();u.useEffect(()=>{if(r.height===0){const h=375*e.height/e.width;o({...r,height:h,orientation:h>375?"portrait":"landscape"})}},[e,r,o]);const c=u.useRef(null),l=u.useRef(null),f=u.useRef({x:0,y:0}),d=u.useRef(!1),g=h=>{d.current&&a({...t,left:h.clientX-f.current.x,top:h.clientY-f.current.y})},i=h=>{d.current=!1},j=h=>{d.current=!1},y=h=>{s("text"),d.current=!0,f.current={x:h.clientX-t.left,y:h.clientY-t.top}};return n.jsx("div",{className:"workspace",children:n.jsxs("div",{className:"canvas",style:{height:r.height,backgroundColor:r.backgroundColor},onMouseMove:g,onMouseUp:i,onMouseLeave:j,ref:l,children:[n.jsx("img",{src:e.url,alt:""}),t.text&&n.jsxs("div",{className:"text",style:{left:t.left,top:t.top,fontSize:`${t.fontSize}px`},ref:c,onMouseDown:y,children:[n.jsx("input",{type:"text",value:t.text,onChange:h=>a({...t,text:h.target.value}),style:{color:t.color}}),n.jsx("div",{className:"deleteTextButton",onClick:()=>a({...t,text:""}),children:n.jsx(k,{path:"/general/delete.svg",alt:""})})]})]})})}function je({previewImg:e}){return n.jsxs("div",{className:"editor",children:[n.jsx(G,{previewImg:e}),n.jsx(ge,{previewImg:e}),n.jsx(xe,{previewImg:e})]})}const be=async e=>(await q.post("/pins",e)).data;function ye(){const[e,t]=u.useState(null),[a,r]=u.useState(!1),[o,s]=u.useState(""),[c,l]=u.useState(!1),[f,d]=u.useState({url:"",width:0,height:0}),{textOptions:g,canvasOptions:i,resetStore:j}=E(),y=u.useRef(),{currentUser:h}=Q(),C=U();u.useEffect(()=>{h||C("/auth")},[C,h]),u.useEffect(()=>{if(e){const p=new Image;p.src=URL.createObjectURL(e),p.onload=()=>{d({url:p.src,width:p.width,height:p.height})}}},[e]);const b=V({mutationFn:be,onSuccess:p=>{j(),C(`/pin/${p._id}`)}}),m=async()=>{if(a)r(!1);else{const p=new FormData(y.current);p.append("media",e),p.append("textOptions",JSON.stringify(g)),p.append("canvasOptions",JSON.stringify(i)),p.append("newBoard",o),b.mutate(p)}},{data:N,isPending:w,error:F}=W({queryKey:["formBoards",h==null?void 0:h._id],queryFn:()=>q.get(`/boards/${h==null?void 0:h._id}`).then(p=>p.data),enabled:!!h}),L=()=>{l(p=>!p)};return n.jsxs("div",{className:"createPage",children:[n.jsxs("div",{className:"createTop",children:[n.jsx("h1",{children:a?"Design your Pin":"Create Pin"}),n.jsx("button",{onClick:m,children:a?"Done":"Publish"})]}),a?n.jsx(je,{previewImg:f}):n.jsxs("div",{className:"createBottom",children:[f.url?n.jsxs("div",{className:"preview",children:[n.jsx("img",{src:f.url,alt:""}),n.jsx("div",{className:"editIcon",onClick:()=>r(!0),children:n.jsx(k,{path:"/general/edit.svg",alt:""})})]}):n.jsxs(n.Fragment,{children:[n.jsxs("label",{htmlFor:"file",className:"upload",children:[n.jsxs("div",{className:"uploadTitle",children:[n.jsx(k,{path:"/general/upload.svg",alt:""}),n.jsx("span",{children:"Choose a file"})]}),n.jsx("div",{className:"uploadInfo",children:"We recommend using high quality .jpg files less than 20 MB or .mp4 files less than 200 MB."})]}),n.jsx("input",{type:"file",id:"file",hidden:!0,onChange:p=>t(p.target.files[0])})]}),n.jsxs("form",{className:"createForm",ref:y,children:[n.jsxs("div",{className:"createFormItem",children:[n.jsx("label",{htmlFor:"title",children:"Title"}),n.jsx("input",{type:"text",placeholder:"Add a title",name:"title",id:"title"})]}),n.jsxs("div",{className:"createFormItem",children:[n.jsx("label",{htmlFor:"description",children:"Description"}),n.jsx("textarea",{rows:6,type:"text",placeholder:"Add a detailed description",name:"description",id:"description"})]}),n.jsxs("div",{className:"createFormItem",children:[n.jsx("label",{htmlFor:"link",children:"Link"}),n.jsx("input",{type:"text",placeholder:"Add a link",name:"link",id:"link"})]}),(!w||!F)&&n.jsxs("div",{className:"createFormItem",children:[n.jsx("label",{htmlFor:"board",children:"Board"}),n.jsxs("select",{name:"board",id:"board",children:[n.jsx("option",{value:"",children:"Choose a board"}),N==null?void 0:N.map(p=>n.jsx("option",{value:p._id,children:p.title},p._id))]}),n.jsxs("div",{className:"newBoard",children:[o&&n.jsx("div",{className:"newBoardContainer",children:n.jsx("div",{className:"newBoardItem",children:o})}),n.jsx("div",{className:"createBoardButton",onClick:L,children:"Create new board"})]})]}),n.jsxs("div",{className:"createFormItem",children:[n.jsx("label",{htmlFor:"tags",children:"Tagged topics"}),n.jsx("input",{type:"text",placeholder:"Add tags",name:"tags",id:"tags"}),n.jsx("small",{children:"Don't worry, people won't see your tags"})]})]}),c&&n.jsx(Z,{setIsNewBoardOpen:l,setNewBoard:s})]})]})}export{ye as default};
